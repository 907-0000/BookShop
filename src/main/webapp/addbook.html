<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="css/bootstrap.css">
		<link rel="stylesheet" href="css/bootoast.css">
		<link rel="stylesheet" href="css/bootstrap-datepicker3.css">
		<!-- 导入包 -->
		<script src="js/jquery-3.6.0.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/bootstrap.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/bootoast.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/bootstrap-datepicker.js"></script>
		<script src="js/bootstrap-datepicker.zh-CN.min.js"></script>
		<style>
			.input-group {
				margin: auto 1px;
			}

			.btn {
				margin: 10px 20px;
			}
		</style>
		<script>
			$(function() {
					$('#pubDate').datepicker({
						format:'yyyy-mm-dd',
						autoclose: true,
						language: 'zh-CN'
					});
					$('#pubDate').datepicker('setDate',new Date());
					
					$('#btnAdd').click(function(){
						//验证表单输入是否合法
						if(!validForm()){
							return false;
						}
						//校验通过，添加
						$.ajax({
							url:'add_book',
							type:'post',
							cache:false,
							data: $('#form1').serialize(),
							dataType:'json',
							success:function (rst) {
								if (rst.code==1){
									bootoast({
										message:rst.msg,
										type:'success',
										position: 'top',
										timeout:2
									});
									//清空组件

								}else{
									bootoast({
										message:rst.msg,
										type:'danger',
										position: 'top',
										timeout:2
									})
								}
							}
						});
					});
					function validForm(){
						var bookName = $('#bookname').val();
						var bookType = $('#bookType').val();
						var publish = $('#publish').val();
						var price = $('#price').val();
						var storages = $('#storages').val();
						var author = $('#author').val();
						
						if(bookName==''){
							bootoast({
							message:'图书名不能为空',
							type:'danger',
							position:'top',
							timeout:2
							});
							return false;
						}
						if(bookType=='-1'){
							bootoast({
							message:'图书类型必须选择',
							type:'danger',
							position:'top',
							timeout:2
							});
							return false;
						}
						if(publish==''){
							bootoast({
							message:'出版社不能为空',
							type:'danger',
							position:'top',
							timeout:2
							});
							return false;
						}
						if(price==''){
							bootoast({
							message:'图书价格不能为空',
							type:'danger',
							position:'top',
							timeout:2
							});
							return false;
						}
						if(parseFloat(price) <= 0){
							bootoast({
							message:'图书价格不能为0或负数',
							type:'danger',
							position:'top',
							timeout:2
							});
							return false;
						}
						if(storages==''){
							bootoast({
							message:'库存量不能为空',
							type:'danger',
							position:'top',
							timeout:2
							});
							return false;
						}
						if(parseInt(storages) <= 0){
							bootoast({
							message:'库存量不能为0或负数',
							type:'danger',
							position:'top',
							timeout:2
							});
							return false;
						}
						if(author==''){
							bootoast({
							message:'作者不能为空',
							type:'danger',
							position:'top',
							timeout:2
							});
							return false;
						}
						// bootoast({
						// message:'成功',
						// type:'success',
						// position:'top',
						// timeout:2
						// });
						return true;
					}
					getTypes();
			});

			function getTypes() {
				$.ajax({
					url:'get_all_types',
					type:'post',
					cache:false,
					data: {},
					dataType:'json',
					success:function (rst) {
						$("#bookType").empty();
						if (rst.code==1){
							for (const type of rst.data) {
								$("#bookType").append(`<option value="${type.typeId}">${type.typeName}</option>`)
							}

						}
					}
				});
			}
		</script>
	</head>
	<body>

		<ul class="breadcrumb">
			<li><a href="welcome.html" target="cards">图书管理</a></li>
			<li class="active">新增图书</li>
		</ul>
		<div class="container-fluid">

			<form class="form-horizontal" id="form1">
				<!-- 水平排列 -->
				<div class="row">
					<div class="col-sm-6">
						<div class="form-group">
							<label for="bookname" class="control-label col-sm-4 ">图书名</label>
							<div class="col-sm-7">
								<input type="text" class="form-control " name="bookName" id="bookname">
							</div>
						</div>
					</div>
					<div class="col-sm-6">
						<div class="form-group">
							<label for="bookType" class="control-label col-sm-3">图书类别</label>
							<div class="col-sm-7">
								<select name="typeId" id="bookType" class="form-control" >
									<option value="-1">选择类型</option>
									<option value="1">类型1</option>
								</select>
							</div>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-sm-6">
						<div class="form-group">
							<label for="publish" class="control-label col-sm-4">出版社</label>
							<div class="col-sm-7">
								<input type="text" class="form-control " name="publish" id="publish">
							</div>
						</div>
					</div>
					<div class="col-sm-6">
						<div class="form-group">
							<label for="pubDate" class="control-label col-sm-3">出版日期</label>
							<div class="col-sm-7">
								<div class="input-group">
									<input type="text" class="form-control date " name="publicDate" id="pubDate">
									<span class="input-group-addon glyphicon glyphicon-calendar"  id="calspan"></span>
								</div>
								
							</div>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-sm-6">
						<div class="form-group">

							<label for="price" class="control-label col-sm-4">价格</label>
							<div class="col-sm-7">
								<div class="input-group">
									<input type="text" class="form-control" name="price" id="price">
									<span class="input-group-addon">元</span>
								</div>

							</div>

						</div>
					</div>

					<div class="col-sm-6">
						<div class="form-group">
							<label for="storages" class="control-label col-sm-3">库存量</label>
							<div class="col-sm-7">
								<div class="input-group">
									<input type="number" class="form-control " name="storages" id="storages">
									<span class="input-group-addon"> 册 </span>
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="form-group">
					<label for="author" class="control-label col-sm-2">作者</label>
					<div class="col-sm-7">
						<input type="text" id="author" name="author" class="form-control">
					</div>
				</div>


				<div class="form-group">
					<label for="bootpic" class="control-label col-sm-2">封面图</label>
					<div class="col-sm-7">
						<input type="file" id="bootpic" name="bookPic" class="form-control">
					</div>
				</div>

				<div class="form-group">
					<label for="depict" class="control-label col-sm-2">图书描述</label>
					<div class="col-sm-7">
						<textarea name="depict" id="depict"  rows="3" class="form-control"></textarea>
					</div>
				</div>


				<div class="form-group text-center">
					<input type="button" value="添 加" class="btn btn-success" id="btnAdd">
					<input type="reset" value="清 空" class="btn btn-default">
				</div>




			</form>

		</div>
	</body>
</html>
